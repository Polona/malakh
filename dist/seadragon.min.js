/*! Seadragon v0.9.0pre | (c) 2013 Laboratorium EE
//@ sourceMappingURL=seadragon.min.map
*/this.Seadragon={},function(e,t,i){"use strict";function n(e){var i=$(e.data.documentElement);if(!i||"Image"!==i.prop("tagName"))throw Error("Sorry, we only support Deep Zoom Image!");var n=i.attr("Format"),o=i.children("size"),a="This doesn't appear to be a valid Deep Zoom Image.";if(!o)throw Error(a);var s=parseInt(o.attr("Width"),10),h=parseInt(o.attr("Height"),10),l=parseInt(i.attr("TileSize"),10),g=parseInt(i.attr("Overlap"),10);if(!s||!h||!l)throw Error(a);var c=r(e.dziUrl);return e.bounds||(e.bounds=new t.Rectangle(0,0,s,h)),new t.DziImage({$container:e.$container,width:s,height:h,tileSize:l,tileOverlap:g,tilesUrl:c,fileFormat:n,bounds:e.bounds,shown:e.shown})}function r(e){var t=e.split("/"),i=t[t.length-1],n=i.lastIndexOf(".");return n>-1&&(t[t.length-1]=i.slice(0,n)),t.join("/")}t.Config={debugMode:!1,debugTileBorders:!1,blockMovement:{horizontal:!1,vertical:!1},blockZoom:!1,constraintViewport:!1,minLevelToDraw:8,animationTime:1e3,blendTime:500,springStiffness:5,imageLoaderLimit:4,imageLoaderTimeout:15e3,zoomPerScroll:1.2,maxImageCacheCount:100,magnifierZoom:2,magnifierRadius:200,backgroundColor:"#2d2a2b"},t.Point=function(){var e=arguments[0];null==e?(this.x=0,this.y=0):null==e.x?(this.x=e||0,this.y=arguments[1]||0):(this.x=e.x||0,this.y=e.y||0)},t.Point.prototype={plus:function(e){return new t.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new t.Point(this.x-e.x,this.y-e.y)},multiply:function(e){return new t.Point(this.x*e,this.y*e)},divide:function(e){return new t.Point(this.x/e,this.y/e)},negate:function(){return new t.Point(-this.x,-this.y)},invert:function(){return new t.Point(1/this.x,1/this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},apply:function(e){return new t.Point(e(this.x),e(this.y))},round:function(){return new t.Point(Math.round(this.x),Math.round(this.y))},equals:function(e){return e instanceof t.Point&&this.x===e.x&&this.y===e.y},toString:function(){return"("+this.x+", "+this.y+")"}},t.Segment=function(e,t,i,n){this.x1=e||0,this.y1=t||0,this.x2=i||0,this.y2=n||0},t.Segment.prototype={equals:function(e){return e instanceof t.Segment&&this.x1===e.x1&&e.y1===e.y1&&this.x2===e.x2&&e.y2===e.y2},toString:function(){return"[("+this.x1+", "+this.y1+"), "+"("+this.x2+", "+this.y2+")]"}},t.Rectangle=function(){var e=arguments[0];null==e?(this.x=0,this.y=0,this.width=0,this.height=0):null==e.x?(this.x=e||0,this.y=arguments[1]||0,this.width=arguments[2]||0,this.height=arguments[3]||0):(this.x=e.x||0,this.y=e.y||0,this.width=e.width||0,this.height=e.height||0)},t.Rectangle.prototype={getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height)},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2)},getSize:function(){return new t.Point(this.width,this.height)},equals:function(e){return e instanceof t.Rectangle&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},panBy:function(e){var t=this.getCenter();this.panTo(t.plus(e))},panTo:function(e){this.x=e.x-this.width/2,this.y=e.y-this.height/2},containsPoint:function(e){return this.x<=e.x&&e.x<=this.x+this.width&&this.y<=e.y&&e.y<=this.y+this.height},intersectsSegment:function(e,i){var n,r,o,a,s,h,l,g;return e instanceof t.Segment?(i?(n="x",r="y",o="width",a="height"):(n="y",r="x",o="height",a="width"),e[r+"1"]<this[r]||e[r+"1"]>this[r]+this[a]?!1:(s=e[n+"1"],h=e[n+"2"],l=this[n],g=this[n]+this[o],(s>l||h>l)&&(g>s||g>h))):(console.error("Function intersetsSegment expects a Seadragon.Segment instance as a parameter"),!1)},intersectsRectangle:function(e){var i=e.x,n=e.x+e.width,r=e.y,o=e.y+e.height;return e.containsPoint(this.getCenter())||this.intersectsSegment(new t.Segment(i,r,n,r),!0)||this.intersectsSegment(new t.Segment(n,r,n,o),!1)||this.intersectsSegment(new t.Segment(n,o,i,o),!0)||this.intersectsSegment(new t.Segment(i,o,i,r),!1)},toString:function(){return"["+this.x+", "+this.y+", "+this.width+" x "+this.height+"]"}},t.Spring=function(e){this.currentValue=e||0,this.startValue=this.currentValue,this.targetValue=this.currentValue;var t=Date.now();this.startTime=t,this.targetTime=t,this.cacheIsAnimating=!0},t.Spring.prototype={transform:function(e){var i=t.Config.springStiffness;return(1-Math.exp(-e*i))/(1-Math.exp(-i))},get:function(e){return e?this.currentValue:this.targetValue},springTo:function(e,i){this.cacheIsAnimating=!0,this.startValue=this.currentValue,this.startTime=Date.now(),this.targetValue=e,this.targetTime=i?this.startTime:this.startTime+t.Config.animationTime},resetTo:function(e){this.springTo(e,!0)},isAnimating:function(){return this.cacheIsAnimating?(this.cacheIsAnimating=this.currentValue!==this.targetValue,this.cacheIsAnimating):!1},update:function(){var e=Date.now();this.currentValue=e>=this.targetTime?this.targetValue:this.startValue+(this.targetValue-this.startValue)*this.transform((e-this.startTime)/(this.targetTime-this.startTime))}},t.ImageLoader=function(){this.downloading=0},t.ImageLoader.prototype={loadImage:function(e,i){function n(){if(o.downloading--,"function"==typeof i)try{i(s)}catch(t){console.error("Error while executing "+e+" callback.",t)}}function r(){a&&clearTimeout(a),s.onload=s.onabort=s.onerror=null,setTimeout(n,1,e,s.complete?s:null)}if(this.downloading>=t.Config.imageLoaderLimit)return!1;var o=this;this.downloading++;var a,s=new Image;return s.onload=s.onabort=s.onerror=r,a=setTimeout(r,t.Config.imageLoaderTimeout),s.src=e,!0}},t.TiledImage=function(e){if(null==e||null==e.$container||null==e.width||null==e.height||null==e.tileSize||null==e.tileOverlap)throw console.log("Received arguments: "),console.log(Array.prototype.slice.apply(arguments)),Error("Seadragon.TiledImage needs a JSON parameter with at least the following fields: $container, width, height, tileSize.\nFields: tileOverlap, bounds, minLevel, maxLevel, shown are optional.");this.width=e.width,this.height=e.height,this.minLevel=e.minLevel?e.minLevel:t.Config.minLevelToDraw,this.maxLevel=e.maxLevel?e.maxLevel:Math.ceil(Math.log(Math.max(e.width,e.height))/Math.log(2)),this.tileSize=e.tileSize,this.tileOverlap=e.tileOverlap?e.tileOverlap:1,e.bounds||(e.bounds=new t.Rectangle(0,0,e.width,e.height)),this.bounds=new t.AnimatedRectangle(e.$container,e.bounds),this.blending=!1,this.blendStart=null,this.hiding=!1,null==e.shown&&(e.shown=!0),this.opacity=e.shown?1:0},t.TiledImage.prototype={isShown:function(){return!this.blending&&1===this.opacity},isHidden:function(){return!this.blending&&0===this.opacity},isShowing:function(){return this.blending&&!this.hiding},isHiding:function(){return this.blending&&this.hiding},getAdjustedLevel:function(e,t){var i=this.getBoundsScale(t);return e+Math.ceil(Math.log(Math.max(i.x,i.y))/Math.log(2))},getUnadjustedLevel:function(e,t){var i=this.getBoundsScale(t);return e-Math.ceil(Math.log(Math.max(i.x,i.y))/Math.log(2))},getBoundsScale:function(e){var i;return i=this.bounds.getRectangle(e),new t.Point(i.width/this.width,i.height/this.height)},getLevelScale:function(e){return Math.pow(.5,this.maxLevel-e)},getNumTiles:function(e){var i=this.getLevelScale(e),n=Math.ceil(i*this.width/this.tileSize),r=Math.ceil(i*this.height/this.tileSize);return new t.Point(n,r)},getScaledDimensions:function(e,i){var n=this.bounds.getRectangle(i);return new t.Point(n.width,n.height).multiply(this.getLevelScale(e))},getTileAtPoint:function(e,i,n){var r=this.getBoundsScale(n),o=this.bounds.getRectangle(n);i=i.minus(new t.Point(o.x,o.y)),i.x/=r.x,i.y/=r.y;var a=i.multiply(this.getLevelScale(e)),s=Math.floor(a.x/this.tileSize),h=Math.floor(a.y/this.tileSize);return new t.Point(s,h)},getTileBounds:function(e,i,n,r){var o,a,s,h,l,g,c;return o=this.getBoundsScale(r),a=this.bounds.getRectangle(r),s=0===i?0:this.tileSize*i-this.tileOverlap,h=0===n?0:this.tileSize*n-this.tileOverlap,l=this.tileSize+(0===i?1:2)*this.tileOverlap,g=this.tileSize+(0===n?1:2)*this.tileOverlap,c=this.getLevelScale(e),s/=c,h/=c,l/=c,g/=c,l=Math.min(l,this.width-s),g=Math.min(g,this.height-h),s=a.x+s*o.x,h=a.y+h*o.y,l*=o.x,g*=o.y,new t.Rectangle(s,h,l,g)},getTileUrl:function(){return console.error("Method not implemented."),""},fitBounds:function(e,t){this.bounds.fitBounds(e,t)}},t.AnimatedRectangle=function(e,i){var n=this;if(null==e||!(i instanceof t.Rectangle))throw console.log("Received arguments: "),console.log(Array.prototype.slice.apply(arguments)),Error("Incorrect paremeters given to Seadragon.AnimatedRectangle!\nUse Seadragon.AnimatedRectangle($container, bounds)");this.isAnimating=!0;var r=Date.now();Object.defineProperties(this,{version:{get:function(){return n.isAnimating&&(n.isAnimating=n.springs.x.isAnimating()||n.springs.y.isAnimating()||n.springs.width.isAnimating()||n.springs.height.isAnimating(),r=Date.now()),r},set:function(){console.error("Seadragon.AnimatedRectangle's version parameter can't be manually changed")}}}),this.$container=e,this.springs={x:new t.Spring(i.x),y:new t.Spring(i.y),width:new t.Spring(i.width),height:new t.Spring(i.height)}},t.AnimatedRectangle.prototype={getRectangle:function(e){return new t.Rectangle(this.springs.x.get(e),this.springs.y.get(e),this.springs.width.get(e),this.springs.height.get(e))},getAspectRatio:function(e){return this.getRectangle(e).getAspectRatio()},getTopLeft:function(e){return this.getRectangle(e).getTopLeft()},getBottomRight:function(e){return this.getRectangle(e).getBottomRight()},getSize:function(e){return this.getRectangle(e).getSize()},getCenter:function(e){return this.getRectangle(e).getCenter()},panTo:function(e,t){this.springs.x.springTo(e.x-this.springs.width.targetValue/2,t),this.springs.y.springTo(e.y-this.springs.height.targetValue/2,t),this.isAnimating=!0,this.$container.trigger("seadragon.forceredraw")},panBy:function(e,t){this.panTo(this.getCenter().plus(e),t)},update:function(){var e=this.getRectangle(!0);this.springs.x.update(),this.springs.y.update(),this.springs.width.update(),this.springs.height.update();var t=this.springs.x.currentValue!==e.x||this.springs.y.currentValue!==e.y||this.springs.width.currentValue!==e.width||this.springs.height.currentValue!==e.height;return t&&this.$container.trigger("seadragon.forceredraw"),t},fitBounds:function(e,t){this.isAnimating=!0,this.springs.x.springTo(e.x,t),this.springs.y.springTo(e.y,t),this.springs.width.springTo(e.width,t),this.springs.height.springTo(e.height,t)}},t.Magnifier=function(e,i){if(!(e instanceof t.Point&&i))throw console.log("Received arguments: "),console.log(Array.prototype.slice.apply(arguments)),Error("Incorrect paremeters given to Seadragon.Magnifier!\nUse Seadragon.Magnifier(center, radius). Radius has to be a positive number.");this.center=e,this.radius=i},t.Magnifier.prototype={panBy:function(e){this.center.x+=e.x,this.center.y+=e.y},panTo:function(e){this.center.x=e.x,this.center.y=e.y},contains:function(e){return this.center.distanceTo(e)<=this.radius},intersectsRectangle:function(e){return e.intersectsRectangle(new t.Rectangle(this.center.x-this.radius/t.Config.magnifierZoom,this.center.y-this.radius/t.Config.magnifierZoom,2*this.radius/t.Config.magnifierZoom,2*this.radius/t.Config.magnifierZoom))},drawPath:function(e){e.lineWidth=5,e.strokeStyle="#00d5ef",e.beginPath(),e.arc(this.center.x,this.center.y,t.Config.magnifierRadius,0,2*Math.PI,!0),e.closePath(),e.fillStyle=t.Config.backgroundColor,e.fill(),e.clip();var i=20;e.moveTo(this.center.x-i/2,this.center.y),e.lineTo(this.center.x+i/2,this.center.y),e.moveTo(this.center.x,this.center.y-i/2),e.lineTo(this.center.x,this.center.y+i/2)},drawOnFinish:function(e){e.lineWidth=5,e.strokeStyle="#00d5ef",e.stroke()},toString:function(){return"Magnifier(("+this.center.x+", "+this.center.y+"), "+this.radius+")"}},t.Magnifier=function(e,i){if(!(e instanceof t.Point&&i))throw console.log("Received arguments: "),console.log(Array.prototype.slice.apply(arguments)),Error("Incorrect paremeters given to Seadragon.Magnifier!\nUse Seadragon.Magnifier(center, radius). Radius has to be a positive number.");this.center=e,this.radius=i},t.Magnifier.prototype={panBy:function(e){this.center.x+=e.x,this.center.y+=e.y},panTo:function(e){this.center.x=e.x,this.center.y=e.y},contains:function(e){return this.center.distanceTo(e)<=this.radius},intersectsRectangle:function(e){return e.intersectsRectangle(new t.Rectangle(this.center.x-this.radius/t.Config.magnifierZoom,this.center.y-this.radius/t.Config.magnifierZoom,2*this.radius/t.Config.magnifierZoom,2*this.radius/t.Config.magnifierZoom))},drawPath:function(e){e.lineWidth=5,e.strokeStyle="#00d5ef",e.beginPath(),e.arc(this.center.x,this.center.y,t.Config.magnifierRadius,0,2*Math.PI,!0),e.closePath(),e.fillStyle=t.Config.backgroundColor,e.fill(),e.clip();var i=20;e.moveTo(this.center.x-i/2,this.center.y),e.lineTo(this.center.x+i/2,this.center.y),e.moveTo(this.center.x,this.center.y-i/2),e.lineTo(this.center.x,this.center.y+i/2)},drawOnFinish:function(e){e.lineWidth=5,e.strokeStyle="#00d5ef",e.stroke()},toString:function(){return"Magnifier(("+this.center.x+", "+this.center.y+"), "+this.radius+")"}},t.DziImage=function(e){if(null==e||null==e.$container||null==e.width||null==e.height||null==e.tileSize||null==e.tilesUrl||null==e.fileFormat)throw console.log("\nReceived options: "),console.log(e),Error("Seadragon.DziImage needs a JSON parameter with at least the following fields: $container, width, height, tileSize, tilesUrl, fileFormat.\nFields: tileOverlap, bounds, minLevel, maxLevel, shown are optional.");t.TiledImage.call(this,{$container:e.$container,width:e.width,height:e.height,tileSize:e.tileSize,tileOverlap:e.tileOverlap,bounds:e.bounds,minLevel:e.minLevel,maxLevel:e.maxLevel,shown:e.shown}),this.tilesUrl=e.tilesUrl,this.fileFormat=e.fileFormat},t.DziImage.prototype=Object.create(t.TiledImage.prototype),$.extend(t.DziImage.prototype,{getTileUrl:function(e,t,i){return this.tilesUrl+"_files/"+e+"/"+t+"_"+i+"."+this.fileFormat}}),t.DziImage.createFromDzi=function(e){if(null==e||null==e.dziUrl||null==e.$container||null==e.callback)throw console.log("\nReceived options: "),console.log(e),Error("Seadragon.DziImage's createFromDzi method needs a JSON parameter with at least the following fields: dziUrl, $container, callback.\nFields: bounds, index, shown are optional.");if(!e.dziUrl)throw Error("No url to DZI given!");$.ajax({type:"GET",url:e.dziUrl,dataType:"xml",success:function(t){e.data=t,e.callback(n(e),e.index)},error:function(e,t){throw Error("Unable to retrieve the given DZI file, does it really exist? ",t)}})},t.Viewport=function(e){if(null==e)throw console.log("Received arguments: "),console.log(Array.prototype.slice.apply(arguments)),Error("Incorrect paremeter given to Seadragon.Viewport!\nUse Seadragon.Viewport($container)");var n=e.css(["width","height"]),r=parseInt(n.width,10),o=parseInt(n.height,10);t.AnimatedRectangle.call(this,e,new t.Rectangle(0,0,r,o)),this.containerSize=new t.Point(r,o),this.maxLevelScale=1/0,this.constraintBounds=i},t.Viewport.prototype=Object.create(t.AnimatedRectangle.prototype),$.extend(t.Viewport.prototype,{getZoom:function(e){return this.containerSize.x/this.springs.width.get(e)},zoomTo:function(e,i,n,r){n instanceof t.Point||(n=this.getCenter());var o=this.getAspectRatio(),a=this.getRectangle(),s=n.minus(new t.Point(a.x,a.y)),h=new t.Point(s.x/a.width,s.y/a.height);this.springs.width.springTo(this.containerSize.x/e,i),this.springs.height.springTo(this.springs.width.targetValue/o,i),this.springs.x.springTo(n.x-h.x*this.springs.width.targetValue,i),this.springs.y.springTo(n.y-h.y*this.springs.height.targetValue,i),r||this.applyConstraints(!1,n),this.$container.trigger("seadragon.forceredraw")},zoomBy:function(e,t,i,n){this.zoomTo(this.getZoom()*e,t,i,n)},panTo:function(e,i,n){t.AnimatedRectangle.prototype.panTo.call(this,e,i),n||this.applyConstraints(!1),this.$container.trigger("seadragon.forceredraw")},panBy:function(e,t,i){this.panTo(this.getCenter().plus(e),t,i)},fitBounds:function(e,i){var n=this.getAspectRatio(),r=e.getCenter(),o=new t.Rectangle(e.x,e.y,e.width,e.height);o.getAspectRatio()>=n?(o.height=e.width/n,o.y=r.y-o.height/2):(o.width=e.height*n,o.x=r.x-o.width/2),t.AnimatedRectangle.prototype.fitBounds.call(this,o,i),this.$container.trigger("seadragon.forcealign")},fitConstraintBounds:function(e){return this.constraintBounds instanceof t.Rectangle?(this.fitBounds(this.constraintBounds,e),i):(console.error("Can't fit the viewport to constraintBounds because they're not set."),i)},resize:function(e){var i=this.getZoom();this.containerSize=new t.Point(e.x,e.y),this.springs.width.resetTo(this.containerSize.x/i),this.springs.height.resetTo(this.springs.width.get()*this.containerSize.y/this.containerSize.x),this.applyConstraints(!0)},applyConstraints:function(e,n){if(t.Config.constraintViewport){if(!(this.constraintBounds instanceof t.Rectangle))return console.error("Can't apply constraints because constraintBounds is not set."),i;var r,o=!1,a="height",s=this.constraintBounds,h=this.getRectangle(),l=h.getAspectRatio(),g=s.width/s.height;if(g>l&&(a="width"),h[a]>s[a])o=!0,r=h[a]/s[a];else{var c=this.deltaPixelsFromPoints(new t.Point(s.width,s.height));c.x>this.maxLevelScale?(o=!0,r=this.maxLevelScale/c.x):c.y>this.maxLevelScale&&(o=!0,r=this.maxLevelScale/c.y)}o&&(this.zoomBy(r,e,n,!0),h=this.getRectangle());for(var u=[{start:"x",length:"width"},{start:"y",length:"height"}],d=0;2>d;d++){var f=u[d],m=f.start,p=f.length;if(h[p]>s[p])o=!0,h[m]=s[m]+s[p]/2-h[p]/2;else if(h[m]<s[m]&&h[m]+h[p]<s[m]+s[p]||h[m]>s[m]&&h[m]+h[p]>s[m]+s[p]){o=!0;var w=Math.abs(s[m]-h[m]),y=Math.abs(s[m]+s[p]-h[m]-h[p]),v=Math.min(w,y);h[m]>s[m]&&(v=-v),h[m]+=v}}o&&this.panTo(h.getCenter(),e,!0)}},deltaPixelsFromPoints:function(e,t){return e.multiply(this.getZoom(t))},deltaPointsFromPixels:function(e,t){return e.divide(this.getZoom(t))},pixelFromPoint:function(e,t){var i,n;return i=this.getRectangle(t),n=this.getZoom(t),e.minus(i.getTopLeft()).multiply(n)},pointFromPixel:function(e,t){var i=this.getRectangle(t),n=this.getZoom(t);return e.divide(n).plus(i.getTopLeft())},pointRectangleFromPixelRectangle:function(e,i){var n=e.getTopLeft(),r=e.getSize(),o=this.pointFromPixel(n,i),a=this.deltaPointsFromPixels(r,i);return new t.Rectangle(o.x,o.y,a.x,a.y)},pixelRectangleFromPointRectangle:function(e,i){var n=e.getTopLeft(),r=e.getSize(),o=this.pixelFromPoint(n,i),a=this.deltaPixelsFromPoints(r,i);return new t.Rectangle(o.x,o.y,a.x,a.y)}}),t.Picker=function(e,i){function n(){e.append(u),$(document).on({mouseup:g})}function r(){$(document).off({mouseup:g}),d.hide(),u.detach()}function o(i){var n=e.offset();return new t.Point(i.pageX-n.left,i.pageY-n.top)}function a(e,t,i){var n,r,o={begin:0,middle:1,end:2};if(e.x-p>t||t>e.x+e.width+p)return"default";if(e.y-p>i||i>e.y+e.height+p)return"default";switch(n=e.x+p>t&&e.x+e.width/2>t?o.begin:t>e.x+e.width-p?o.end:o.middle,r=e.y+p>i&&e.y+e.height/2>i?o.begin:i>e.y+e.height-p?o.end:o.middle,n){case o.begin:switch(r){case o.begin:return"nw-resize";case o.middle:return"w-resize";case o.end:return"sw-resize";default:return console.log("Error 1! xPos: "+n+", yPos: "+r),"default"}break;case o.middle:switch(r){case o.begin:return"n-resize";case o.middle:return"default";case o.end:return"s-resize";default:return console.log("Error 2! xPos: "+n+", yPos: "+r),"default"}break;case o.end:switch(r){case o.begin:return"ne-resize";case o.middle:return"e-resize";case o.end:return"se-resize";default:return console.log("Error 3! xPos: "+n+", yPos: "+r),"default"}break;default:return console.error("Error 4! xPos: "+n+", yPos: "+r),"default"}}function s(e,t,i,n){null==i&&(i=!0),null==n&&(n=!0),u.on({mousemove:function(r){var a=o(r),s="";n&&(f.toBottom=a.y>=t,f.toBottom?(d.css({top:t,height:a.y-t}),s+="s"):(d.css({top:a.y,height:t-a.y}),s+="n")),i&&(f.toRight=a.x>=e,f.toRight?(d.css({left:e,width:a.x-e}),s+="e"):(d.css({left:a.x,width:e-a.x}),s+="w")),s+="-resize",u.css("cursor",s)}})}function h(){var e=d.css(["left","top","width","height"]);return new t.Rectangle(parseInt(e.left,10),parseInt(e.top,10),parseInt(e.width,10),parseInt(e.height,10))}function l(){u.on({mousemove:function(e){var t=o(e);if(!m){var i,n=$(this);i=d.is(":visible")?a(h(),t.x,t.y):"default",n.css("cursor",i)}}})}function g(e){if(m){u.off("mousemove"),l();var t=i.pointRectangleFromPixelRectangle(h());console.log("areaBounds: ["+t.x+", "+t.y+", "+t.width+", "+t.height+"], right: "+(t.x+t.width)+", bottom: "+(t.y+t.height)),m=!1,0===t.width&&0===t.height&&d.hide();var n=$.Event("mousemove");n.pageX=e.pageX,n.pageY=e.pageY,u.trigger(n)}}function c(){l(),u.on({mousedown:function(e){if(1!==e.which)return!1;m=!0;var t,i=o(e),n=d.css(["left","top","width","height"]),r={x:parseInt(n.left,10),y:parseInt(n.top,10),width:parseInt(n.width,10),height:parseInt(n.height,10)};switch(t=d.is(":visible")?a(r,i.x,i.y):"default"){case"default":var h=i.x,l=i.y;d.css({left:h,top:l,width:0,height:0}),d.show(),s(h,l);break;case"n-resize":s(null,r.y+r.height,!1,!0);break;case"w-resize":s(r.x+r.width,null,!0,!1);break;case"s-resize":s(null,r.y,!1,!0);break;case"e-resize":s(r.x,null,!0,!1);break;case"nw-resize":s(r.x+r.width,r.y+r.height);break;case"sw-resize":s(r.x+r.width,r.y);break;case"se-resize":s(r.x,r.y);break;case"ne-resize":s(r.x,r.y+r.height)}return!1}})}var u,d,f,m,p=10;(function(){if(null==e||!(i instanceof t.Viewport))throw console.log("Received arguments: "),console.log(Array.prototype.slice.apply(arguments)),Error("Incorrect paremeters given to Seadragon.Picker!\nUse Seadragon.Picker($container, viewport)");f={toRight:!0,toBottom:!0},m=!1,u=$('<div class="pickerOverlay" />').css({position:"absolute",zIndex:100,left:0,top:0,width:"100%",height:"100%",backgroundColor:"transparent"}),d=$('<div class="pickerArea" />').css({position:"absolute",display:"none",zIndex:150,left:0,top:0,backgroundColor:"transparent",border:"5px dashed #00d5ef"}),u.append(d),c()})(),this.show=n,this.hide=r},t.Markers=function(e,i){function n(e,t){h.push({object:e,rectangle:t}),s.append(e),o()}function r(){h=[],s.html("")}function o(){$.each(h,function(e,t){var n=i.pixelRectangleFromPointRectangle(t.rectangle,!0),r=t.object;r.css({left:n.x,top:n.y,width:n.width,height:n.height})})}function a(){e.on({"seadragon.animation":o})}var s,h=[];(function(){if(null==e||!(i instanceof t.Viewport))throw console.log("Received arguments: "),console.log(Array.prototype.slice.apply(arguments)),Error("Incorrect paremeters given to Seadragon.Markers!\nUse Seadragon.Markers($container, viewport)");s=$('<div class="markerOverlay" />'),e.append(s),a()})(),this.addMarker=n,this.deleteMarkers=r},t.Tile=function(e){if(null==e||null==e.level||null==e.x||null==e.y||null==e.bounds||null==e.url)throw console.log("\nReceived options: "),console.log(e),Error("Seadragon.Tile needs a JSON parameter with at least the following fields: level, x, y, bounds, exists, url.");this.version=Date.now(),this.level=e.level,this.x=e.x,this.y=e.y,this.bounds=e.bounds,this.failedToLoad=!1,this.loaded=!1,this.loading=!1,this.image=null,this.url=e.url,this.position=null,this.blendStart=null,this.opacity=null,this.targetCenter=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0},t.Tile.prototype={updateVersion:function(){this.version=Date.now()},drawCanvas:function(e,i,n){if(!this.loaded)throw Error("Attempting to draw tile "+(""+this)+" when it's not yet loaded.");var r=this.position,o=this.size;null!=i&&1!==i&&(r=r.minus(n).multiply(i).plus(n),o.x*=i,o.y*=i),e.globalAlpha=this.opacity,e.drawImage(this.image,r.x,r.y,o.x,o.y),t.Config.debugTileBorders&&e.strokeRect(r.x,r.y,o.x,o.y),e.globalAlpha=1},unload:function(){this.image=null,this.loaded=!1,this.loading=!1},toString:function(){return this.level+"/"+this.x+"_"+this.y}},t.CanvasLayersManager=function(e,t){if(null==e)throw Error("Can't create a CanvasLayersManager instance without a context parameter!");this.clear(),this.context=e,this.magnifier=t,this.tiles=[[],[]]},t.CanvasLayersManager.prototype={addToLayer:function(e,t){this.tiles[e].push(t)},drawLayer:function(e){var i,n,r,o,a;for(n=this.tiles[e],r=1===e&&this.drawMagnifier,r&&(this.context.save(),this.magnifier.drawPath(this.context)),i=0;n.length>i;i++)o=n[i],a=r?t.Config.magnifierZoom:1,o.drawCanvas(this.context,a,this.magnifier.center);r&&(this.magnifier.drawOnFinish(this.context),this.context.restore())},drawCanvas:function(){this.drawLayer(0),this.drawLayer(1)},clear:function(){this.tiles=[[],[]]}},t.Drawer=function(e){function n(e){e?(document.body.style.cursor="none",M=!0):(document.body.style.cursor="",M=!1)}function r(e,t){return I[e][t]||(I[e][t]=x[e].getNumTiles(t)),I[e][t]}function o(e,t){if(!L[e][t]){var i=x[e].getScaledDimensions(t).invert();L[e][t]=Math.max(i.x,i.y)}return L[e][t]}function a(e,i,n,r,o,a){var s,h,l,g,c,u=!1;return s=D[e],h=x[e],s[i]||(s[i]=[]),s[i][n]||(s[i][n]=[]),s[i][n][r]||(l=h.getTileBounds(i,n,r,a),g=h.getTileUrl(i,n,r),s[i][n][r]=new t.Tile({level:i,x:n,y:r,bounds:l,url:g}),u=!0),c=s[i][n][r],!u&&h.bounds.version>c.version&&(l=h.getTileBounds(i,n,r,a),c.bounds=l,c.updateVersion()),c.lastTouchTime=o,c}function s(e,t){e.loading=R.loadImage(e.url,function(i){h(e,t,i)})}function h(e,t,n){var r;if(e.loading=!1,j)return console.error("Tile load callback in the middle of drawing routine."),i;if(!n)return console.error("Tile "+e+" failed to load: "+e.url),e.failedToLoad=!0,i;if(N>t)return console.log("Ignoring tile "+e+" loaded before reset: "+e.url),i;e.loaded=!0,e.image=n;var o=A.length;if(A.length>=q){var a=null,s=-1;for(r=A.length-1;r>=0;r--){var h=A[r];if(!h.beingDrawn)if(a){var l=h.lastTouchTime,g=a.lastTouchTime,c=h.level,u=a.level;(g>l||l===g&&c>u)&&(a=h,s=r)}else a=h,s=r}a&&s>=0&&(a.unload(),o=s)}A[o]=e,T.trigger("seadragon.forceredraw")}function l(){D=[],A=[]}function g(e,t,i,n){var r,o;if(!C[e][t])return!1;if(null==i||null==n){var a=C[e][t];for(r in a)if(a.hasOwnProperty(r)){var s=a[r];for(o in s)if(s.hasOwnProperty(o)&&!s[o])return!1}return!0}return null==C[e][t][i]||null==C[e][t][i][n]||C[e][t][i][n]}function c(e,t,i,n){return null==i||null==n?g(e,t+1):g(e,t+1,2*i,2*n)&&g(e,t+1,2*i,2*n+1)&&g(e,t+1,2*i+1,2*n)&&g(e,t+1,2*i+1,2*n+1)}function u(e,t,n,r,o){return C[e][t]?(C[e][t][n]||(C[e][t][n]=[]),C[e][t][n][r]=o,i):(console.error("Setting coverage for a tile before its level's coverage has been reset: "+t),i)}function d(e,t){C[e][t]=[]}function f(e,i,n){if(!e)return i;if(i.visibility>e.visibility)return i;if(i.visibility===e.visibility&&n instanceof t.Point){var r=n.distanceTo(i.targetCenter),o=n.distanceTo(e.targetCenter);if(o>r)return i}return e}function m(e,n,r){var o=x[e];if(!(o instanceof t.DziImage))return console.error("Can't "+(n?"hide":"show")+" DZI of number "+e+", there is no such DZI."),i;var a=n?0:1;r?o.opacity=a:o.blending||(o.opacity=n?1:0),o.hiding=n,o.blendStart=Date.now(),o.blending&&(o.blendStart-=(1-Math.abs(a-o.opacity))*t.Config.blendTime),o.blending=!0,y()}function p(e,t){m(e,!1,t)}function w(e,t){m(e,!0,t)}function y(){var e,i,n,h,l,m,p,w,y,v,T;if(j)return!0;j=!0;for(var P=!1;B.length>0;)i=B.pop(),V.pop(),i.beingDrawn=!1;var R=b.containerSize;z.width=R.x,z.height=R.y,Y.canvasLayersManager.clear();var I=b.getRectangle(!0),L=I.getTopLeft(),C=I.getBottomRight(),D=b.pixelFromPoint(b.getCenter()),k=b.getZoom(!0),A=[],$=[],F=[],O=[],Z=[],E=null,N=[],q=[],J=[];for(U=Date.now(),w=0;x.length>w;w++)if(e=x[w],e instanceof t.DziImage&&!e.isHidden()){A[w]=e.bounds.getTopLeft(),$[w]=e.bounds.getBottomRight();var W=A[w],X=$[w];X.x<L.x||X.y<L.y||W.x>C.x||W.y>C.y||(F[w]=new t.Point(Math.max(L.x,W.x),Math.max(L.y,W.y)),O[w]=new t.Point(Math.min(C.x,X.x),Math.min(C.y,X.y)),e.blending&&(P=!0,h=U-e.blendStart,l=Math.min(1,h/t.Config.blendTime),e.opacity=e.hiding?1-l:l,(e.isHiding()&&0===e.opacity||e.isShowing()&&1===e.opacity)&&(e.blending=!1)),N[w]=o(w,0),Z[w]=!1,q[w]=!1,J.push(w))}for(T=Y.maxLevel;T>=0;T--)for(m=0;J.length>m;m++)if(w=J[m],!q[w]){e=x[w];var _=e.getAdjustedLevel(T);if(L=F[w],C=O[w],n=N[w],!(_>e.maxLevel||e.minLevel>_)){var G=!1,K=k/e.getLevelScale(T);if(M&&(K*=t.Config.magnifierZoom),!Z[w]&&K>=H||_===e.minLevel)G=!0,Z[w]=!0;else if(!Z[w])continue;d(w,_);var Q=o(w,_),et=n/Math.abs(n-Q),tt=e.getTileAtPoint(_,L,!0),it=e.getTileAtPoint(_,C,!0),nt=r(w,_),rt=nt.x,ot=nt.y;for(tt.x=Math.max(tt.x,0),tt.y=Math.max(tt.y,0),it.x=Math.min(it.x,rt-1),it.y=Math.min(it.y,ot-1),y=tt.x;it.x>=y;y++)for(v=tt.y;it.y>=v;v++){i=a(w,_,y,v,U,!0);var at=G;if(u(w,_,y,v,!1),!i.failedToLoad&&(Z[w]&&!at&&(c(w,_,y,v)?u(w,_,y,v,!0):at=!0),at)){var st=i.bounds.getTopLeft(),ht=i.bounds.getSize(),lt=b.pixelFromPoint(st,!0),gt=b.deltaPixelsFromPoints(ht,!0),ct=M&&null!=S&&S.intersectsRectangle(new t.Rectangle(lt.x,lt.y,gt.x,gt.y)),ut=b.pixelFromPoint(st,!1),dt=b.deltaPixelsFromPoints(ht,!1),ft=ut.plus(dt.divide(2));if(i.position=lt,i.size=gt,i.targetCenter=ft,i.visibility=et,i.loaded)i.blendStart||(i.blendStart=U),h=U-i.blendStart,l=Math.min(1,h/t.Config.blendTime),i.opacity=l*e.opacity,B.push(i),V.push(ct?1:0),l>=1?u(w,_,y,v,!0):P=!0;else if(!i.loading){var mt;mt=M?S.center:D,E=f(E,i,mt)}}}g(w,_)&&(q[w]=!0)}}for(E&&(s(E,U),P=!0),m=B.length-1;m>=0;m--){for(i=B[m],p=0;V[m]>=p;p++)Y.canvasLayersManager.addToLayer(p,i);i.beingDrawn=!0}return Y.canvasLayersManager.drawCanvas(),j=!1,P}function v(){l(),N=Date.now(),T.trigger("seadragon.forceredraw")}var x,b,S,T,z,P,R,M,I,L,C,D,k,A,B,V,F,O,Z,E,U,N,j,Y=this,q=500,H=.5;(function(){if(null==e||null==e.viewport||null==e.$container)throw console.log("\nReceived options: "),console.log(e),Error("Seadragon.Drawer needs a JSON parameter with at least the following fields: viewport, $container.\nParameter magnifier is optional.");x=[],b=e.viewport,S=e.magnifier,T=$(e.$container),z=T.find("canvas").get(0),P=z.getContext("2d"),Y.canvasLayersManager=new t.CanvasLayersManager(P,S),Y.element=T,T.append($(z)),R=new t.ImageLoader(t.Config.imageLoaderLimit),M=!1,I=[],L=[],C=[],D=[],k=[],A=[],B=[],V=[],F=[],O=[],Z=[],E=[],Y.maxLevel=0,U=Date.now(),N=0,j=!1})(),this.addDziImage=function(e,t){if(j){console.log("Deferred adding a DZI to Drawer");var n=this;return setTimeout(function(){n.addDziImage(e,t)},100),i}return e?("number"==typeof t?x[t]=e:(t=e.length,x.push(e)),I[t]=[],L[t]=[],D[t]=[],C[t]=[],i):(console.error("No DZI Image given to Drawer's addDziImage method!"),i)},this.setMagnifier=n,this.showDzi=p,this.hideDzi=w,this.update=y,this.reset=v},t.Controller=function(e){function n(e){var i=v.offset();return new t.Point(e.pageX-i.left,e.pageY-i.top)}function r(){$(document).off("mousemove",a),u()}function o(){x.on({mouseenter:function(){L&&(B.drawer.canvasLayersManager.drawMagnifier=!0,u())},mouseleave:function(){L&&(B.drawer.canvasLayersManager.drawMagnifier=!1,u())},mousedown:function(e){return 1!==e.which||L?!1:(M=n(e),$(document).on("mousemove",a),!1)},wheel:function(e){return L||!e.deltaY?!1:(s(e),u(),!1)}}),v.on({"seadragon.forcealign":function(){z=!0,u()},"seadragon.forceredraw":function(){u()}}),$(document).on({mouseup:r}),$(window).on({resize:u})}function a(e){var i=n(e),r=i.minus(M),o=t.Config.blockMovement;o.horizontal&&(r.x=0),o.vertical&&(r.y=0),B.viewport.panBy(B.viewport.deltaPointsFromPixels(r.negate())),M=i}function s(e){if(!t.Config.blockZoom){var i=t.Config.zoomPerScroll;e.deltaY>0&&(i=1/i),B.viewport.zoomBy(i,!1,B.viewport.pointFromPixel(n(e),!0))}}function h(e){var t=n(e);B.magnifier.panTo(t),u()}function l(){A=0;for(var e=0;B.dziImages.length>e;e++){var t=B.dziImages[e];A=Math.max(A,t.getUnadjustedLevel(t.maxLevel))}B.viewport.maxLevelScale=Math.pow(2,A),B.drawer.maxLevel=A}function g(e,t){return e?("number"!=typeof t&&(t=B.dziImages.length),B.dziImages[t]=e,B.drawer.addDziImage(e,t),A=Math.max(A,e.maxLevel),B.viewport.maxLevelScale=Math.pow(2,A),B.drawer.maxLevel=A,R--,v.trigger("seadragon.loadeddzi"),0===R&&v.trigger("seadragon.loadeddziarray"),u(),i):(console.error("No DZI Image given to Viewer's onOpen()!"),i)}function c(){if(!D){if(m())return setTimeout(c,1),i;f(),setTimeout(c,1)
}}function u(){P=!0,D&&(D=!1,c())}function d(e){z=B.dziImages[e].bounds.update()||z,u()}function f(){var e=v.css(["width","height"]),i=new t.Point(parseInt(e.width,10),parseInt(e.height,10));i.equals(I)||(P=!0,I=i,B.viewport.resize(i));var n=B.viewport.update()||z||P;z&&(z=!1,setTimeout(function(){for(var e=0;B.dziImages.length>e;e++)setTimeout(d,17,e)},17)),n?P=B.drawer.update():D=!0,!T&&n?(v.trigger("seadragon.animationstart"),v.trigger("seadragon.animation")):n?v.trigger("seadragon.animation"):T&&v.trigger("seadragon.animationfinish"),T=n}function m(){return R>0}function p(e,n,r,o,a){var s,h,g,c,u,f,w;if(m())return setTimeout(p,100,e,n,r,o,a),i;for(u=f=0,o||(o=1/0),s=0;B.dziImages.length>s;s++)c=B.dziImages[s],e?(h=c.width*n/c.height,g=n,u+h>o&&(u=0,f+=g+r)):(h=n,g=c.height*n/c.width,f+g>o&&(f=0,u+=h+r)),w=new t.Rectangle(u,f,h,g),e?u+=h+r:f+=g+r,c.fitBounds(w,a),d(s);l(),v.trigger("seadragon.forcealign")}function w(e,t){return B.dziImages[e].bounds.getRectangle(t)}function y(e,t){var i=w(e,t);return B.viewport.pixelRectangleFromPointRectangle(i,t)}var v,x,b,S,T,z,P,R,M,I,L,C,D,k,A,B=this;(function(){if(v=$(e),0===v.length)throw console.log("\nReceived containerSelectorOrElement: "),console.log(e),Error("Can't create a Controller instance without a container!");v.empty(),v.css({backgroundColor:t.Config.backgroundColor}),x=$("<canvas />"),v.append(x),b=S=0,B.dziImages=[],L=C=!1,D=k=!1,A=0,R=0,o();var i=v.css(["width","height"]);I=new t.Point(parseInt(i.width,10),parseInt(i.height,10)),B.viewport=new t.Viewport(v),B.magnifier=new t.Magnifier(new t.Point(0,0),t.Config.magnifierRadius),B.picker=new t.Picker(v,B.viewport),B.markers=new t.Markers(v,B.viewport),B.drawer=new t.Drawer({viewport:B.viewport,$container:v,magnifier:B.magnifier}),T=!1,z=P=!0,c()})(),this.showMagnifier=function(){$(document).mouseup(),L=!0,B.drawer.setMagnifier(!0),B.drawer.canvasLayersManager.drawMagnifier=!0,x.on("mousemove",h),x.trigger("mousemove")},this.hideMagnifier=function(){x.off("mousemove",h),B.drawer.canvasLayersManager.drawMagnifier=!1,B.drawer.setMagnifier(!1),L=!1,P=!0},this.toggleMagnifier=function(){L?B.hideMagnifier():B.showMagnifier()},this.showPicker=function(){C=!0,B.picker.show()},this.hidePicker=function(){C=!1,B.picker.hide()},this.togglePicker=function(){C?B.hidePicker():B.showPicker()},this.getMousePosition=n,this.forceUpdate=u,this.openDzi=function(e,i,n,r,o){o||R++;try{t.DziImage.createFromDzi({dziUrl:e,$container:v,bounds:r,index:i,shown:n,callback:g})}catch(a){R--,console.error("DZI failed to load.")}},this.openDziArray=function(e,t,i){var n;null==t&&(t=[]);var r=e.length;for(R+=r,n=0;r>n;n++)B.openDzi(e[n],n,!i,t[n],!0)},this.isLoading=m,this.close=function(){$(window).off({resize:u}),$(document).off({mouseup:r,mousemove:a}),v.off(),v.empty()},this.alignRows=function(e,t,i,n){p(!0,e,t,i,n)},this.alignColumns=function(e,t,i,n){p(!1,e,t,i,n)},this.fitImage=function(e,t){var n=B.dziImages[e];return n?(B.viewport.fitBounds(n.bounds.getRectangle(t)),i):(console.error("No image with number "+e),i)},this.dziImageBoundsInPoints=w,this.dziImageBoundsInPixels=y,this.showDzi=function(e,t){B.drawer.showDzi(e,t),u()},this.hideDzi=function(e,t){B.drawer.hideDzi(e,t),u()}}}(this,this.Seadragon);